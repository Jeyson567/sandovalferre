<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>POS ‚Äì Inventario</title>

<style>
table { width:100%; border-collapse:collapse; margin-top:10px; }
th, td { border-bottom:1px solid #ccc; padding:4px; }
.total { font-size:18px; font-weight:bold; text-align:right; }
</style>
</head>

<body>

<h2>POS ‚Äì FERRETER√çA (Inventario + Venta)</h2>

<h3>Registrar / Agregar Existencia</h3>
<input id="codigo" placeholder="C√≥digo de barras">
<input id="nombre" placeholder="Nombre del producto">
<input id="precio" type="number" placeholder="Precio normal (Q)">
<input id="precioMin" type="number" placeholder="Precio m√≠nimo permitido (Q)">
<input id="stock" type="number" placeholder="Cantidad a agregar">
<button onclick="guardar()">Guardar / Sumar</button>

<hr>

<h3>üì¶ Inventario</h3>
<table>
<thead>
<tr>
  <th>C√≥digo</th>
  <th>Producto</th>
  <th>Stock</th>
  <th>Precio</th>
  <th>M√≠nimo</th>
</tr>
</thead>
<tbody id="tablaInv"></tbody>
</table>

<hr>

<h3>üõí Venta</h3>
<input id="scan" placeholder="C√≥digo + ENTER">

<table>
<thead>
<tr>
  <th>Producto</th>
  <th>Cant</th>
  <th>Precio</th>
  <th>Total</th>
</tr>
</thead>
<tbody id="tabla"></tbody>
</table>

<div class="total" id="totalVenta">Total: Q0.00</div>
<button onclick="finalizar()">Finalizar venta</button>

<script>
let inventario = JSON.parse(localStorage.getItem("inv")) || {};
let carrito = [];

function guardar() {
  const c = codigo.value.trim();
  const n = nombre.value.trim();
  const p = Number(precio.value);
  const pmin = Number(precioMin.value);
  const s = Number(stock.value);

  if (!c || !s) {
    alert("C√≥digo y cantidad son obligatorios");
    return;
  }

  if (inventario[c]) {
    inventario[c].stock += s;
    alert("‚úÖ Existencia agregada");
  } else {
    if (!n || !p || !pmin) {
      alert("Complete todos los datos para nuevo producto");
      return;
    }
    inventario[c] = {
      nombre:n,
      precio:p,
      precioMin:pmin,
      stock:s
    };
    alert("‚úÖ Producto creado");
  }

  localStorage.setItem("inv", JSON.stringify(inventario));
  limpiar();
  mostrarInventario();
}

function limpiar() {
  codigo.value = nombre.value = precio.value = precioMin.value = stock.value = "";
}

function mostrarInventario() {
  tablaInv.innerHTML = "";
  for (let c in inventario) {
    const p = inventario[c];
    tablaInv.innerHTML += `
      <tr>
        <td>${c}</td>
        <td>${p.nombre}</td>
        <td>${p.stock}</td>
        <td>Q${p.precio.toFixed(2)}</td>
        <td>Q${p.precioMin.toFixed(2)}</td>
      </tr>
    `;
  }
}

scan.addEventListener("keydown", e => {
  if (e.key === "Enter") {
    vender(scan.value.trim());
    scan.value = "";
  }
});

function vender(c) {
  const p = inventario[c];
  if (!p) return alert("Producto no registrado");
  if (p.stock <= 0) return alert("Sin existencia");

  let cant = Number(prompt(`Existencia: ${p.stock}\n¬øCu√°ntas unidades llevar√°?`));
  if (!cant || cant > p.stock) return alert("Cantidad inv√°lida");

  let precioVenta = Number(prompt(
    `Precio normal: Q${p.precio}\nPrecio m√≠nimo: Q${p.precioMin}\n\nPrecio por unidad:`,
    p.precio
  ));

  if (precioVenta < p.precioMin) return alert("Debajo del m√≠nimo");

  p.stock -= cant;

  carrito.push({
    nombre:p.nombre,
    cant:cant,
    precio:precioVenta,
    total:cant*precioVenta
  });

  localStorage.setItem("inv", JSON.stringify(inventario));
  mostrarInventario();
  actualizar();
}

function actualizar() {
  tabla.innerHTML = "";
  let total = 0;
  carrito.forEach(i => {
    total += i.total;
    tabla.innerHTML += `
      <tr>
        <td>${i.nombre}</td>
        <td>${i.cant}</td>
        <td>Q${i.precio.toFixed(2)}</td>
        <td>Q${i.total.toFixed(2)}</td>
      </tr>
    `;
  });
  totalVenta.textContent = "Total: Q" + total.toFixed(2);
}

function finalizar() {
  carrito = [];
  actualizar();
  alert("Venta finalizada");
}

mostrarInventario();
</script>

</body>
</html>