<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>POS ‚Äì Ferreter√≠a Sandoval</title>

<style>
body {
  font-family: Arial, sans-serif;
  background:#f2f2f2;
  margin:0;
  padding:10px;
}
h1 { text-align:center; }
section {
  background:#fff;
  padding:10px;
  margin-bottom:10px;
  border-radius:6px;
}
input, button {
  width:100%;
  padding:6px;
  margin:4px 0;
}
button { cursor:pointer; }
table {
  width:100%;
  border-collapse:collapse;
  font-size:14px;
}
th, td {
  border-bottom:1px solid #ccc;
  padding:4px;
}
.total {
  text-align:right;
  font-size:18px;
  font-weight:bold;
}

/* === IMPRESI√ìN TICKET 80mm === */
@media print {
  body {
    width:80mm;
    margin:0;
    background:#fff;
    font-size:12px;
  }
  .no-print { display:none; }
}
</style>
</head>

<body>

<h1>FERRETER√çA SANDOVAL</h1>

<!-- REGISTRO DE PRODUCTOS -->
<section class="no-print">
<h3>üì¶ Registro de Producto</h3>
<input id="codigo" placeholder="C√≥digo de barras (escanea aqu√≠)">
<input id="nombre" placeholder="Nombre del producto">
<input id="categoria" placeholder="Categor√≠a">
<input id="existencia" type="number" step="0.01" placeholder="Existencia">
<input id="precio" type="number" step="0.01" placeholder="Precio normal Q">
<input id="precioMin" type="number" step="0.01" placeholder="Precio m√≠nimo permitido Q">
<button onclick="guardarProducto()">Guardar producto</button>
</section>

<!-- PUNTO DE VENTA -->
<section class="no-print">
<h3>üõí Punto de Venta</h3>
<input id="scan" placeholder="Escanear producto para vender" autofocus>
<table>
<thead>
<tr><th>Producto</th><th>Cant</th><th>Precio</th><th>Total</th></tr>
</thead>
<tbody id="tablaVenta"></tbody>
</table>
<div class="total" id="totalVenta">Total: Q0.00</div>
<button onclick="finalizarVenta()">Finalizar venta e imprimir</button>
</section>

<!-- CIERRE -->
<section class="no-print">
<h3>üìä Cierre del D√≠a</h3>
<button onclick="cierreDelDia()">Hacer cierre y enviar WhatsApp</button>
</section>

<script>
const telefonoJefe = "50231064872";

let inventario = JSON.parse(localStorage.getItem("inventario_sandoval")) || {};
let ventasDia = JSON.parse(localStorage.getItem("ventas_dia")) || [];
let ticketNum = Number(localStorage.getItem("ticket_num")) || 1;
let carrito = [];

/* ===== GUARDAR PRODUCTO (ARREGLADO) ===== */
function guardarProducto() {
  const c = codigo.value.trim();
  const n = nombre.value.trim();

  if (!c || !n) {
    alert("C√≥digo y nombre son obligatorios");
    return;
  }

  inventario[c] = {
    nombre: n,
    categoria: categoria.value.trim(),
    existencia: Number(existencia.value) || 0,
    precio: Number(precio.value) || 0,
    precioMin: Number(precioMin.value) || 0
  };

  localStorage.setItem("inventario_sandoval", JSON.stringify(inventario));
  alert("‚úÖ Producto guardado correctamente");

  codigo.value = "";
  nombre.value = "";
  categoria.value = "";
  existencia.value = "";
  precio.value = "";
  precioMin.value = "";
}

/* ===== ESCANEO PARA VENTA ===== */
scan.addEventListener("keydown", e => {
  if (e.key === "Enter") {
    agregarVenta(scan.value.trim());
    scan.value = "";
  }
});

function agregarVenta(cod) {
  const p = inventario[cod];
  if (!p) {
    alert("Producto no registrado");
    return;
  }
  if (p.existencia <= 0) {
    alert("Sin existencia");
    return;
  }

  let precioCobro = prompt(
    `Precio normal: Q${p.precio}\nPrecio m√≠nimo permitido: Q${p.precioMin}\n\nPrecio a cobrar:`,
    p.precio
  );

  precioCobro = Number(precioCobro);
  if (precioCobro < p.precioMin) {
    alert("No se permite cobrar menos del precio m√≠nimo");
    return;
  }

  p.existencia -= 1;
  carrito.push({
    nombre: p.nombre,
    cant: 1,
    precio: precioCobro,
    total: precioCobro
  });

  localStorage.setItem("inventario_sandoval", JSON.stringify(inventario));
  actualizarTabla();
}

function actualizarTabla() {
  tablaVenta.innerHTML = "";
  let total = 0;

  carrito.forEach(i => {
    total += i.total;
    tablaVenta.innerHTML += `
      <tr>
        <td>${i.nombre}</td>
        <td>${i.cant}</td>
        <td>Q${i.precio.toFixed(2)}</td>
        <td>Q${